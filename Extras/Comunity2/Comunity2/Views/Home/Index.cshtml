@model List<Post>

@{
    ViewData["Title"] = "المنشورات";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    body {
        background-color: #f0f0f0;
        font-family: 'Segoe UI', sans-serif;
    }

    .post-card {
        background-color: #ffffff;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .post-header {
        font-size: 18px;
        font-weight: bold;
        color: #333;
    }

    .post-content {
        font-size: 16px;
        margin-top: 10px;
        color: #555;
    }

    .likes-section {
        display: flex;
        align-items: center;
        margin-top: 15px;
    }

    .like-button {
        background-color: #e0e0e0;
        border: none;
        padding: 6px 12px;
        border-radius: 8px;
        margin-right: 10px;
        cursor: pointer;
        color: #333;
        transition: background-color 0.3s ease;
    }

        .like-button:hover {
            background-color: #ccc;
        }

    .comments {
        margin-top: 15px;
        border-top: 1px solid #ddd;
        padding-top: 10px;
    }

    .comment {
        background-color: #f9f9f9;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 5px;
    }

    .add-comment {
        display: flex;
        margin-top: 10px;
    }

        .add-comment input[type="text"] {
            flex: 1;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #ccc;
            margin-right: 10px;
        }

        .add-comment button {
            background-color: #4CAF50;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

            .add-comment button:hover {
                background-color: #45a049;
            }

    /* تصميم شبكة الصور */
    .images-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 12px;
        margin-top: 15px;
    }

        .images-grid img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

            .images-grid img:hover {
                transform: scale(1.05);
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            }

    /* Lightbox */
    #lightbox {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0,0,0,0.8);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    }

        #lightbox img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 12px;
            box-shadow: 0 0 30px rgba(255,255,255,0.5);
        }
</style>

<header>
    <nav>
        <a asp-action="Add" asp-controller="Post">Add New Post</a>
    </nav>
</header>

<div class="container mt-4">
    <h2 class="mb-4 text-center">جميع المنشورات</h2>

    @foreach (var post in Model)
    {
        <div class="post-card">
            <div class="post-header">منشور رقم: @post.Id</div>
            <div class="post-content">@post.Text</div>

            @if (post.Images != null && post.Images.Any())
            {
                <div class="images-grid">
                    @foreach (var image in post.Images)
                    {
                        // تحويل بايت إلى Base64 لإظهار الصورة
                        var base64 = Convert.ToBase64String(image.Picture);
                        var imgSrc = $"data:image/jpeg;base64,{base64}";
                        <img src="@imgSrc" alt="صورة منشور" onclick="openLightbox('@imgSrc')" />
                    }
                </div>
            }

            <div class="likes-section">
                <form asp-action="Like" asp-route-id="@post.Id" method="post" style="display:inline;">
                    <button class="like-button" type="submit">👍 إعجاب</button>
                </form>
                <span>@post.Count_Likes إعجابات</span>
            </div>

            <div class="comments">
                @* يمكنك تفعيل التعليقات هنا *@
                @*foreach (var comment in post.Comments)
            {
            <div class="comment">@comment.Text</div>
            }*@

                <form asp-action="AddComment" method="post" class="add-comment">
                    <input type="hidden" name="PostId" value="@post.Id" />
                    <input type="text" name="Text" placeholder="أضف تعليقك..." required />
                    <button type="submit">تعليق</button>
                </form>
            </div>
        </div>
    }
</div>

<!-- Lightbox -->
<div id="lightbox" onclick="closeLightbox()">
    <img id="lightbox-img" src="" alt="عرض الصورة" />
</div>

<script>
    function openLightbox(src) {
        var lightbox = document.getElementById('lightbox');
        var lightboxImg = document.getElementById('lightbox-img');
        lightboxImg.src = src;
        lightbox.style.display = 'flex';
    }

    function closeLightbox() {
        var lightbox = document.getElementById('lightbox');
        lightbox.style.display = 'none';
    }
</script>
